const abi = require('../../src/util/abi');

const testHexAddress = '0x1386b4185a223ef49592233b69291bbe5a80c527';
const base32Address = 'net8888:aak2rra2njvd77ezwjvx04kkds9fzagfe6xm1vavv4';

test('abi.encodeParameter', () => {
  expect(abi.encodeParameter('uint256', 1)).toEqual('0x0000000000000000000000000000000000000000000000000000000000000001');
  expect(abi.encodeParameter('uint256[]', [1, 2])).toEqual('0x000000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000002');
  expect(abi.encodeParameter('address', testHexAddress)).toEqual('0x0000000000000000000000001386b4185a223ef49592233b69291bbe5a80c527');
  expect(abi.encodeParameter('address', base32Address)).toEqual('0x0000000000000000000000001386b4185a223ef49592233b69291bbe5a80c527');
  expect(abi.encodeParameter('string', 'hello world')).toEqual('0x000000000000000000000000000000000000000000000000000000000000000b68656c6c6f20776f726c64000000000000000000000000000000000000000000');
});

test('abi.encodeParameter struct', () => {
  expect(abi.encodeParameter({
    balance: 'uint256',
    address: 'address',
  }, {
    balance: 1,
    address: testHexAddress,
  })).toEqual('0x00000000000000000000000000000000000000000000000000000000000000010000000000000000000000001386b4185a223ef49592233b69291bbe5a80c527');
});

test('abi.decodeParameter', () => {
  expect(abi.decodeParameter('uint256', '0x0000000000000000000000000000000000000000000000000000000000000001')).toEqual(BigInt(1));
  expect(abi.decodeParameter('address', '0x0000000000000000000000001386b4185a223ef49592233b69291bbe5a80c527')).toEqual(testHexAddress);
  expect(abi.decodeParameter('address', '0x0000000000000000000000001386b4185a223ef49592233b69291bbe5a80c527', 8888)).toEqual(base32Address);
});

test('abi.encodeParameters', () => {
  expect(abi.encodeParameters(['uint256', 'string'], [1, 'hello world'])).toEqual('0x00000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000040000000000000000000000000000000000000000000000000000000000000000b68656c6c6f20776f726c64000000000000000000000000000000000000000000');
});

test('abi.decodeParameters', () => {
  const encoded = '0x00000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000040000000000000000000000000000000000000000000000000000000000000000b68656c6c6f20776f726c64000000000000000000000000000000000000000000';
  expect(abi.decodeParameters(['uint256', 'string'], encoded)).toEqual([BigInt(1), 'hello world']);
});
